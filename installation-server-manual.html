<!doctype html>
<!--
	Jericho Comms - Information-theoretically secure communications
	Copyright (c) 2013-2017  Joshua M. David

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation in version 3 of the License.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see [http://www.gnu.org/licenses/].
-->
<html lang="en">
	<head>
		<title>Jericho Comms&trade; - Server Installation</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		
		<meta name="description" content="Jericho Comms is a secure group chat program using one-time pads.">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="css/reset.css" type="text/css">
		<link rel="stylesheet" href="css/global.css" type="text/css">
		<link rel="stylesheet" href="css/print.css" type="text/css" media="print">
		
		<!--[if IE]>
			<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<![endif]-->		
		<!--[if IE 7]>
			<link rel="stylesheet" href="css/ie7.css" type="text/css">
		<![endif]-->
		<!--[if IE 8]>
			<link rel="stylesheet" href="css/ie8.css" type="text/css">
		<![endif]-->
	</head>
	<body>
		<div class="topSection">
			<div class="topBanner">
				<a class="logo" href="index.html" title="Homepage"></a>			
				<div class="mainNav">
					<ul>						
						<li><a href="information.html">Technical design</a></li>
						<li><a href="https://github.com/joshua-m-david/jerichoencryption">Source code</a></li>
						<li><a href="download.html">Download</a></li>
						<li><a href="installation.html">How to install</a></li>
						<li><a href="usage.html">How to use</a></li>
						<li><a href="faq.html">FAQ</a></li>		
					</ul>
				</div>
			</div>
		</div>
		<div class="content">
			<div class="page installPage">
				<div class="information">
					<h1>Server Installation Guide</h1>
					<p>
						This page explains in an easy step by step guide how to manually setup your
						<a href="https://en.wikipedia.org/wiki/Virtual_private_server">VPS</a> or server and get the software running for 
						Jericho Comms on <a href="http://www.ubuntu.com/download/server">Ubuntu Server 16.04.x</a> Long Term Support (LTS). 
						Open source is the best way as it's auditable and less likely to contain backdoors. Compiling your 
						own from source code is even safer if you know how to do that. If you do not like Ubuntu, you 
						can use whatever Linux or Unix distribution you want, it is really just setting up a Linux, 
						Apache, MySQL & PHP (LAMP) stack and configuring it.<br>
						<br>
						You need approximately <b>1 hour</b> of time and some average computer skills. Be sure to read 
						each step carefully. <b>NB:</b> This guide is no longer maintained, it is preferred to
						<a href="installation-server.html">use the new guide</a> with automated installation script.
					</p>
					
					<h2>Table of Contents</h2>
					<ol class="tableOfContents">
						<li><a href="#vps-sign-up">Sign up for a Virtual Private Server</a></li>
						<li><a href="#install-ubuntu">Download and install Ubuntu Server</a></li>
						<li><a href="#connect-to-server">Connect to your server</a></li>
						<li><a href="#switch-to-root">Switch user to root</a></li>
						<li><a href="#update-server">Update the server</a></li>
						<li><a href="#install-mysql-php-apache">Installing MySQL, PHP and Apache</a></li>
						<li><a href="#test-apache">Test your web server</a></li>
						<li><a href="#test-php">Test the PHP install</a></li>
						<li><a href="#test-mysql">Test MySQL</a></li>
						<li><a href="#upload-program-to-server">Uploading the program onto the server</a></li>
						<li><a href="#verify-signature">Verifying the integrity and authenticity of the file</a></li>
						<li><a href="#extracting-server-files">Extracting the server files</a></li>
						<li><a href="#apache-virtual-host-config">Apache virtual host configuration</a></li>
						<li><a href="#build-skein-library">Build the Skein library</a></li>
						<li><a href="#run-db-script">Run the database script</a></li>
						<li><a href="#edit-config-file">Editing the configuration file</a></li>
						<li><a href="#install-tls-certificate">Create and install a TLS certificate</a></li>
						<li><a href="#setup-secure-profile">Setup a new secure browser profile</a></li>
						<li><a href="#securing-new-profile">Securing your new Firefox profile</a></li>
						<li><a href="#firewall-setup">Setting up the firewall</a></li>
						<li><a href="#ntp-setup">Network Time Protocol configuration</a></li>
						<li><a href="#test-server-code">Test the server code</a></li>
						<li><a href="#summary">Summary</a></li>
					</ol>
					
					
					<h2 id="vps-sign-up">Sign up for a Virtual Private Server</h2>
					<p>
						There are a number of quality VPS providers around. You will need to 
						<a href="https://duckduckgo.com/?q=vps+provider+europe">do some research</a> on your own. Try 
						finding one that is not in any of the 
						<a href="https://en.wikipedia.org/wiki/Five_Eyes">Five Eyes</a> countries 
						(US, UK, Canada, Australia and New Zealand). Perhaps somewhere in Europe with better privacy laws 
						e.g. Finland. Better privacy laws mean they need a proper warrant to hack or shut down your 
						server whereas countries like the UK 
						<a href="https://theintercept.com/2015/06/22/gchq-reverse-engineering-warrants/">can just do whatever they want</a>. 
						Some of the other European countries co-operate with the NSA however 
						<a href="https://en.wikipedia.org/wiki/Five_Eyes#Future_enlargement">in a wider spying alliance</a>. 
						So Brazil or Iceland may be a better bet.<br>
						<br>
						You should only need the most basic server in terms of CPU speed, memory and disk space because 
						the software is not resource intensive. Around 10 Euros (11 USD) per month is probably fine. That 
						will get you around 1 CPU core, 512 MB of RAM and 10 GB of disk space which is plenty to 
						run the server software.<br>
						<br>
						Avoid VPS providers that use <a href="https://en.wikipedia.org/wiki/OpenVZ">OpenVZ</a> because 
						each VPS on the same physical server shares the same Linux kernel. That means you cannot have 
						full control over the VPS to keep the system time properly synchronized with an NTP server. 
						<a href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a> based VPSs use 
						their own kernel which gives you much more control.<br>
						<br>
						Alternatively if you want to run your own server on your own network, that is even better. 
						This would be the most secure option as you can administer the server locally. This means one less 
						port open on the public network interface. The clients and server share a 512 bit symmetric API key 
						for authentication of data going back and forth. However you still need to get that key onto the server. 
						When managing the server via the internet, the security is only as secure as the SSH connection. 
						SSH is hard to secure against active MITM attacks unless you are 
						<a href="">certain of the correct host key fingerprint</a>. For your first connection to the VPS 
						you will not be sure of the server's true fingerprint. You could however try finding it by logging 
						in via the HTTPS web management console or asking your VPS provider directly. Then again they will 
						need to send it to you via encrypted email and you still need to verify their public key somehow. 
						So it ends up being a lot of extra effort. SSH also currently does not have ciphers that are secure against 
						quantum computers. 
					</p>
					
					<h2 id="install-ubuntu">Download and install Ubuntu Server</h2>
					<p>
						If using a VPS, select one of the pre-made Ubuntu 16.04.x LTS images. The online provider will 
						do all the installation automatically for you and initialise your VPS.<br>
						<br>						
						Otherwise if you're setting up your own server, <a href="http://releases.ubuntu.com/16.04/">download the latest</a> version
						of Ubuntu Server 16.04.x LTS. Write the image to a CD/DVD/USB drive, then boot from the install image on CD/DVD/USB drive and run 
						through the installation. This should be pretty self explanatory but there is a step-by-step guide with screenshots 
						<a href="http://www.tecmint.com/installation-of-ubuntu-16-04-server-edition/">here</a> 
						if you need them. Make sure your server has a public, static IP address so your group's users 
						can connect to it reliably over the internet.<br>
						<br>
						At the software selection screen be sure to select <b>OpenSSH server</b> so it gets installed and you can log into your server 
						remotely with SSH. SSH will likely be enabled by default on a VPS.
						<br>						
						<img class="listImage" src="img/server-install-openssh.png" alt="">
					</p>
															
					<h2 id="connect-to-server">Connect to your server</h2>
					<p>
						Assuming your operating system is all installed, you can now log into your VPS/server with 
						<a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a>. If you are connecting to your server from a Windows machine you 
						can use <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a>, for example:<br>
						<br>
						<img class="listImage" src="img/putty-setup.png"><br>
						<br>
						Or from Linux you can use the command line: <code>ssh -p 22 username@ipaddress</code>. Swap out 
						<code>username</code> for the username on your server. You will have created a user account on installation or if using a VPS 
						they probably set up the <code>root</code> account so use that. Swap out <code>ipaddress</code> with the public IP address of 
						your server.
					</p>
					
					<h2 id="switch-to-root">Switch user to root</h2>
					<p>
						If you're using a VPS they may have just given you the details for the <code>root</code> account, so you 
						should already be logged in as root and you won't need to do this step.<br>
						<br>
						Otherwise if you installed Ubuntu from scratch type <code>sudo su</code> to switch to root. Enter your
						user password. This saves entering <code>sudo</code> before every command after this point.
					</p>
										
					<h2 id="update-server">Update the server</h2>
					<p>
						Run <code>apt-get update</code> to refresh the list of all available updates and security patches for your system. Then run 
						<code>apt-get upgrade</code> to apply the updates.
					</p>
					
					<h2 id="install-mysql-php-apache">Installing MySQL, PHP and Apache</h2>
					<p>
						To install MySQL, PHP and Apache, run the following command:<br>
						<code>apt-get install lamp-server^</code><br>
						<br>
						If you are curious about what the ^ does, this is explained 
						<a href="http://tech.shantanugoel.com/2010/10/23/apt-get-caret.html">here</a>. This will start the installation automatically. 
						You will need to type <code>Y</code> when prompted to continue. Also be sure to enter a MySQL password when asked. You will 
						need the password later so remember it.<br>
						<br>
						The PHP <a href="http://php.net/manual/en/book.mcrypt.php">Mcrypt</a> extension is required to 
						collect cryptographically secure random numbers in PHP. Random data is generated for each 
						request received and used with 
						<a href="https://www.isecpartners.com/blog/2011/february/double-hmac-verification.aspx">Double HMAC Verification</a> 
						to prevent timing attacks on the server authentication protocol. You can install the Mcrypt 
						extension with the following commands:<br>
						<code>
							apt-get install php7.0-mcrypt<br>
							phpenmod mcrypt
						</code>
					</p>
					
					<h2 id="test-apache">Test your web server</h2>
					<p>
						Open your web browser and browse to the server IP address, for example, <code>http://192.168.1.101/</code>. This guide setup 
						the server on a web server in the LAN hence the private IP address. This should bring up a page like this:<br>
						<br>
						<img class="listImage" src="img/apache-test.png" alt="Apache test page">
					</p>
					
					<h2 id="test-php">Test the PHP install</h2>
					<p>
						Now make sure the PHP installation is working. This can be done by creating a test file with the following command:<br>
						<code>echo "&lt;?php phpinfo();" | tee /var/www/html/testing.php</code>.<br>
						<br>
						After that, restart the web server with <code>service apache2 restart</code>.<br>
						<br>
						Now you should be able to browse to the server IP address, for example, <code>http://192.168.1.101/testing.php</code> in your 
						web browser which should show a page like below and will show all the default PHP settings.<br>
						<br>
						<img class="listImage" src="img/php-test.png" alt="The phpinfo() output">
					</p>
					
					<h2 id="test-mysql">Test MySQL</h2>
					<p>
						Now test that MySQL works with the command <code>mysql -p</code>. It will prompt you for the password you created on 
						installation. You should now be in a MySQL prompt like this:<br>
						<br>
						<img class="listImage" src="img/mysql-test.png" alt="MySQL prompt"><br>
						<br>
						Type the command <code>show databases;</code> which should show 4 default databases. Now exit out of MySQL by typing 
						<code>exit;</code> or doing a <code>Ctrl</code> + <code>C</code> keyboard command.
					</p>
					
					<h2 id="upload-program-to-server">Uploading the program onto the server</h2>
					<p>
						Now that Linux, Apache, MySQL and PHP are running it's time to install get the server code running. The easiest way to get it 
						onto the server would be to use the command line:<br>
						<code>wget https://joshua-m-david.github.io/jerichoencryption/files/jericho-v1.5.2.tar.gz</code><br>
						<br>
						You also need to download the signature file to verify that the download is authentic:<br>
						<code>wget https://joshua-m-david.github.io/jerichoencryption/files/jericho-v1.5.2.tar.gz.asc</code><br>
						<br>
						This will download the two files and put them inside your current working directory. You can list them with <code>ls -l</code>. 
						If the files are there you can skip to the next step.<br>
						<br>
						If for some reason you are unable to download the files from the website you can always download 
						them from <a href="https://freenetproject.org/">Freenet</a> using the links on the 
						<a href="download.html">Download page</a>, then copying the files manually to the server. If 
						you want to copy them to the server from your Windows machine you can use 
						<a href="http://winscp.net/eng/download.php">WinSCP</a> and connect to your server using the same credentials like you did 
						earlier with PuTTY. Then it's a basic drag and drop operation.<br>
						<br>
						If wanting to transfer the files from your Linux machine to the server you can use the following command:<br>
						<code>scp /path/on/local/machine/jericho-v1.5.2.tar.gz username@ipaddress:~</code><br>
						<br>
						Be sure to swap out <code>username</code> for the username on the server and swap out <code>ipaddress</code> for the IP address 
						of the server. It should prompt you for the password. The <code>~</code> character will put the file in the home directory for 
						your account so it will be available as soon as you log into the server. Instead of the <code>~</code> character you can swap 
						that for the destination path on the server if you wish e.g. <code>/var/www/html/</code>.
					</p>
					
					<h2 id="verify-signature">Verifying the integrity and authenticity of the file</h2>
					<p>
						It's very important you verify the integrity and authenticity of the downloaded file so you know the file is authentic. Otherwise 
						an attacker could have performed a <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM attack</a> and swapped 
						out the file for one with a backdoor in the encryption code.
					</p>
					<h3>Verifying by file hashes</h3>
					<p>
						First verify that the file was downloaded correctly using the hashes found on the <a href="download.html">download page</a>:<br>
						<code>sha384sum jericho-v1.5.2.tar.gz | grep "ad5586e073131c019c3af5996dd123f1cf29de1817d5d1b65fc9cfcd6f00441139a3556dce38f434329d95303ae58965"</code><br>
						<br>
						If the checksum matches it will display the matching hash output on a line on the command line, for example:<br>
						<code>ad5586e073131c019c3af5996dd123f1cf29de1817d5d1b65fc9cfcd6f00441139a3556dce38f434329d95303ae58965 &nbsp;jericho-v1.5.2.tar.gz</code><br>
						<br>
						You can also verify using <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-2 512</a> and 
						<a href="https://en.wikipedia.org/wiki/Whirlpool_%28cryptography%29">Whirlpool</a> hashes on the download page by using 
						<code>sha512sum</code> and <code>whirlpoolsum</code> commands in the format above, along with the corresponding hashes found on the 
						<a href="download.html">download page</a>. It will tell you to install whirlpoolsum so just follow the 
						instructions on the screen.<br>
						<br>
						If nothing is returned on the command line, then the file is a mismatch and you will have to redownload it. 
						You can try downloading it from another source such as FreeNet as well (see the 
						<a href="download.html">download page</a> for a link).
					</p>
					<h3>Verifying by GnuPG signature</h3>
					<p>
						This will verify that the download was actually created by us. The key ID for each download is listed on the 
						<a href="download.html">download page</a>. Import our public key which can be used to verify the file:<br>
						<code>gpg --keyserver x-hkp://pool.sks-keyservers.net --recv-keys 0xDC768471C467B6D0</code><br>
						<br>
						After importing the key you should verify that the key fingerprint is correct with 
						<code>gpg --fingerprint 0xDC768471C467B6D0</code>. You should see:<br>
						<br>
						<code>
							pub &nbsp;&nbsp;4096R/C467B6D0 2013-09-25 [expires: 2018-03-27]<br>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Key fingerprint = CF3F 79EE 0114 59BA 0A59  9E9C DC76 8471 C467 B6D0<br>
							uid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Joshua M. David (Jericho Encryption) &lt;jerichoencryption@rediffmail.com&gt;<br>
							sub &nbsp;&nbsp;4096R/BE456DA7 2013-09-25 [expires: 2018-03-27]
						</code><br>
						<br>
						Then run <code>gpg --verify jericho-v1.5.2.tar.gz.asc jericho-v1.5.2.tar.gz</code> to verify the signature. This should give you a 
						message saying <b>Good signature</b> similar to the following:<br>
						<br>
						<code>
							gpg: Signature made Fri 17 Jun 2016 {time}<br>
							gpg: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using RSA key 0xDC768471C467B6D0<br>
							gpg: Good signature from "Joshua M. David (Jericho Encryption) &lt;jerichoencryption@rediffmail.com&gt;"<br>
							gpg: WARNING: This key is not certified with a trusted signature!<br>
							gpg: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There is no indication that the signature belongs to the owner.<br>
							Primary key fingerprint: CF3F 79EE 0114 59BA 0A59  9E9C DC76 8471 C467 B6D0
						</code><br>
						<br>
						It will likely offer up a warning because you have not assigned a trust index to this person. 
						This means that GnuPG verified that the key made that signature, but it's up to you to decide 
						if that key really belongs to the developer. The best method is usually to meet the developer 
						in person and exchange key fingerprints. Sometimes this is not possible, however you can also 
						check the fingerprint on <a href="https://onename.com/joshua_m_david">onename.com</a> and 
						<a href="https://keybase.io/joshua_m_david">keybase.io</a>. Both of these identities and 
						fingerprints are published on the Bitcoin blockchain. Do not rely on what you see on the 
						websites alone which is only protected by TLS and can be easily altered in real-time by the 
						Five Eyes agencies. Make sure you download the client apps to verify the public keys on the 
						blockchain. If you can review the source code of those apps, even better.
					</p>
					
					<h2 id="extracting-server-files">Extracting the server files</h2>
					<p>
						Now you need to extract files from inside the jericho-v1.5.2.tar.gz archive file. This can be done using:<br>
						<code>tar -zxvf jericho-v1.5.2.tar.gz</code><br>
						<br>
						That will extract the files inside your current working directory. Now we need to copy the server files 
						to the web directory <code>/var/www/html/</code> so that Apache can serve the files. The server files are 
						inside the <code>server/</code> directory. They can be copied to the web directory using the following 
						command:<br>
						<code>cp -rR server/. /var/www/html/</code><br>
						<br>
						Make sure the correct permissions are applied on the server files so Apache can access the files:<br>
						<code>chown -R www-data:www-data /var/www/html/</code><br>
						<code>find /var/www/html -type d -exec chmod 755 {} +</code><br>
						<code>find /var/www/html -type f -exec chmod 644 {} +</code><br>						
						<br>
						You can verify the permissions by running:<br>
						<code>ls -al /var/www/html/</code><br>
						<br>
						<img class="listImage" src="img/server-directory-permissions.png" alt="Server directory permissions">
					</p>
					
					
					<h2 id="apache-virtual-host-config">Apache virtual host configuration</h2>
					<p>
						By default, Apache 2.4 on Ubuntu 16.04 serves up files from /var/www/html/ using a virtual host that is 
						enabled. Run the following command to edit the virtual host file:<br>
						<code>nano /etc/apache2/sites-available/000-default.conf</code><br>
						<br>
						Before the closing <code>&lt;/VirtualHost&gt;</code> directive insert the following:<br>
						<br>
						<code>&lt;Directory /var/www/html&gt;<br>
						&nbsp; Options None<br>
						&nbsp; AllowOverride All<br>
						&nbsp; Require all granted<br>
						&lt;/Directory&gt;</code><br>
						<br>
						This allows Apache to load up the .htaccess file inside the directory which has some additional commands 
						to block access to every file except the index.php which is where all the API requests are directed to. 
						Optionally, if you have a domain name you wish to use with the server, you can add the following lines 
						anywhere inside the VirtualHost directive (replace domain.com with your domain):<br>
						<code>ServerName www.domain.com<br>
						ServerAlias domain.com *.domain.com</code><br>
						<br>
						So if you removed all the comments in the file it should look something like this:<br>
						<img class="listImage" src="img/apache-vhosts-config.png" alt="Apache virtual host config file"><br>
						<br>
						Now restart the web server with the command:<br>
						<code>service apache2 restart</code>
					</p>
					
					
					<h2 id="build-skein-library">Build the Skein library</h2>
					<p>
						The <a href="https://en.wikipedia.org/wiki/Skein_hash">Skein</a> 1.3 hash algorithm is used with a 512 
						bit digest for client authentication with the API. This is written in C and requires an extension to be 
						compiled and added to PHP. The compilation process puts the compiled file in the correct location for PHP.<br>
						<br>
						First install the PHP module development package using:<br>
						<code>apt-get install php7.0-dev</code><br>
						<br>
						Then, run the following commands:<br>
						<code>cd /var/www/html/lib/skein/<br>
						phpize<br>
						./configure --enable-skein<br>
						make<br>
						make install</code><br>
						<br>
						Then edit the php.ini file:<br>
						<code>nano /etc/php/7.0/apache2/php.ini</code><br>
						<br>
						Under the section Dynamic Extensions, add the following on a blank line:<br>
						<code>extension=skein.so</code><br>
						<br>
						It should look like this:<br>
						<img class="listImage" src="img/skein-php-ini.png" alt="Skein extension in php.ini"><br>
						<br>
						To save and exit, use your keyboard and do <code>Ctrl</code> + <code>X</code>. It will ask if you want to 
						save the changes, type <code>Y</code> and press <code>Enter</code>. To make sure the changes are applied, 
						restart the web server with the command:<br>
						<code>service apache2 restart</code>
					</p>
					
					
					<h2 id="run-db-script">Run the database script</h2>
					<p>
						Run the database script <b>createtables.sql</b> to create the database tables on the server. From the Linux command line you 
						can run:<br>
						<code>mysql -u root -p &lt; /var/www/html/createtables.sql</code><br>
						<br>
						This will prompt you for the MySQL root password you created earlier. If this succeeds you can continue to the next section and 
						edit the configuration file.
					</p>
					<h3>Alternate method A</h3>
					<p>
						If you are running Windows, you can also run the database 
						script very easily by downloading a trial version of <a href="https://www.webyog.com/product/downloads">SQLYog</a>. You can 
						do this by connecting via an SSH tunnel to the server and then connect to MySQL from there. For example when creating a new 
						connection, go to the SSH tab:<br>
						<br>
						<img class="listImage" src="img/sqlyog-connect-ssh.png" alt="SQL Yog connection part 1"><br>
						<br>
						You need to swap out the SSH host address, username and password for your Linux server ones. Then click on the MySQL tab:<br>
						<br>
						<img class="listImage" src="img/sqlyog-connect-mysql.png" alt="SQL Yog connection part 2"><br>
						<br>
						Enter in the root password of MySQL that you created earlier. From there you can click <b>Test Connection</b> to make sure everything 
						works, then Connect.<br>
						<br>
						Once inside the main program you can go to <b>File</b> -> <b>Open...</b> then select the <code>createtables.sql</code> file on 
						your hard drive. If you have extracted the files from <code>jericho-v1.5.2.tar.gz</code> using <a href="http://www.7-zip.org/">7-Zip</a> it 
						should be in the <code>jericho/server/</code> directory.<br>
						<br>
						Now select all the SQL querry text with the mouse or <code>Ctrl</code> + <code>A</code>. Then you can click the <b>Execute Current Query</b> 
						button at the top left of the screen which will create the database and tables required:<br>
						<br>
						<img class="listImage" src="img/sqlyog-connect-query.png" alt="SQL Yog query"><br>
						<br>
						You should see some queries being executed on the database. To verify if the database was created you can click on <b>root@localhost</b> 
						in the top left corner of the left window then press F5 which will refresh the list of databases. You should see the 
						<code>jericho</code> database appear in the list.
					</p>					
					<h3>Alternate method B</h3>
					<p>
						If you are using basic shared hosting (non VPS) you might need to include the UNIX socket and full path to the MySQL binary, 
						for example:<br>
						<code>~/private/mysql/bin/mysql --socket=/media/sdm1/home/user/private/mysql/socket -u username -p &lt; createtables.sql</code><br>
						<br>
						You would need to swap out the path to the socket with the one they gave you. Also change the <b>username</b> variable for your MySQL 
						username.
					</p>
					
					<h2 id="edit-config-file">Editing the configuration file</h2>
					<p>
						Now you need to edit the program's configuration file. You can 
						do this with the text editor Nano which will be installed by default.<br>
						Type <code>nano /var/www/html/config/config.php</code> and it should open.<br>
						<br>
						<img class="listImage" src="img/nano-edit-config.png" alt="Edit program server config" style="width: 100%"><br>
						<br>
						First you need to decide how many users will be in your chat group. You can have 2 - 7 chat users per 
						group. Simply change the <i>$numberOfUsers</i> variable to have the number of users you want. 
						For example here is a chat group of 5 users: <code>$numberOfUsers = 5;</code><br>
						<br>
						The <i>$serverKey</i> variable is used to sign all data going to or from the server using the 
						Skein-512 hash. This key will be entered into the client application as well and exported for 
						each user with their one-time pads so they can connect to the server to send/receive messages.<br>
						<br>
						You could actually create the 512 bit key by typing on the keyboard randomly to get 128 hexadecimal 
						symbols from the lowercase letters a-f and numbers 0-9. However that will not be the most secure option. 
						The client program can generate a truly random 512 bit server key for you. This can be done using the 
						TRNG. Open the Jericho Comms <code>client</code> directory, then open <code>index.html</code> with Firefox. 
						Click the Generate Pads button from the main menu which starts the TRNG. Load up a photo of something random 
						in nature then click Process. Once processed, click the Export button which opens up a dialog.<br>
						<br>
						<img class="listImage" src="img/export-pads-server-key-settings.png" alt="Export pads"><br>
						<br>						
						Here you can click Create server key which will extract 512 bits of the random data from the photo. Copy 
						paste this into the config file like so:
						<code>$serverKey = '89975057bac787e526aba890440dd89f95f2ea14a1779dc...2f636ba8eb3ac4bb823086da8541798f67c3a1055d2e';</code><br>
						<br>
						Remember not to remove the quotation marks around the strings or PHP won't run the code. Copy this key down 
						as you will need it later to connect from the client.<br>
						<br>
						Next you need to edit <i>$databaseConfig</i> array. The <b>root</b> username 
						is there already so you don't need to edit that. Replace the password by editing the string next to 
						it which says <code>covert</code> and put in the password you created for MySQL earlier.<br>
						<br>
						Shared hosting users (non VPS) might also need to edit the UNIX socket and port numbers in the <b>config.php</b> 
						file with settings provided by the hosting provider.<br>
						<br>
						To save and exit, use your keyboard and do <code>Ctrl</code> + <code>X</code>. It will ask if you want to 
						save the changes, type <code>Y</code> and press <code>Enter</code>.
					</p>
										
					
					<h2 id="install-tls-certificate">Create and install a TLS certificate</h2>
					<p>
						Using TLS is <u>not</u> required or recommended for version 1.3 and above, but it can add an additional 
						layer of encryption to disguise the protocol's traffic from low level attackers such as your ISP, 
						work, school or public WiFi users. If you really need this, a guide is available 
						<a href="installation-server-tls.html">here</a>. Some of the steps may be slightly duplicated in the 
						remainder of this guide.
					</p>
						
					
					<h2 id="setup-secure-profile">Setup a new secure browser profile</h2>
					<p>
						In this step we will setup a new secure browser or browser profile purely for secure communications. This 
						is mainly because it's handy to have a separate profile so you don't accidentally erase your one-time pads 
						whenever you clear your browser history. It also keeps this profile and extensions separate so nothing 
						can maliciously copy your one-time pads. An extra layer of security would be to install the browser/browser 
						profile into an <a href="http://www.truecrypt.org/docs/tutorial">encrypted volume</a>, 
						so it's encrypted on the storage device as well.<br>
						<br>
						For portability you can download the latest version of Firefox Portable 
						<a href="http://portableapps.com/apps/internet/firefox_portable">from here</a> and install it. If you want 
						to chat from multiple computers, install it onto a USB drive. There exists portable 
						versions of <a href="http://sourceforge.net/projects/crportable/">Chromium</a> as well but 
						this guide will just cover Firefox for now.
					</p>
					<h3>Alternate method</h3>
					<p>
						If you just want to use your existing Firefox install you can follow 
						<a href="http://kb.mozillazine.org/Profile_Manager">these instructions</a> to set up a new profile. 
						The <a href="http://kb.mozillazine.org/Opening_a_new_instance_of_Firefox_with_another_profile">-no-remote</a> option 
						may come in handy when you want to run multiple separate Firefox profiles at the same time.
					</p>
					
					
					<h2 id="securing-new-profile">Securing your new Firefox profile</h2>
					<p>
						This section follows some steps to lock down your browser profile so it is as secure as possible 
						and will only be used for chatting with this program.
					</p>
					
					<h3>Disabling default plugins in the browser</h3>
					<p>
						Now we will disable all the default browser plugins as they are not required and are a potential security hole.<br>
						<br>
						Open the <b>Firefox</b> main menu then click on <b>Add-ons</b><br>
						<br>
						<img class="listImage" src="img/firefox-addon-menu.png"><br>
						<br>
						Then click on <b>Plugins</b> in the left side menu. For every plugin change the option to <b>Never Activate</b>:<br>
						<br>
						<img class="listImage" src="img/firefox-plugins.jpg"><br>
						<br>
						Restart the browser for all the changes to take effect. That covers the basic steps to secure the browser profile. If you have 
						set this up on a portable Firefox install, be sure to copy that install for the other user onto a USB drive so they don't need 
						to repeat the process.
					</p>			
					
					
					<h2 id="firewall-setup">Setting up the firewall</h2>
					<p>
						Now we're going to configure a basic firewall so only SSH and HTTP traffic will be allowed through to the 
						web server. This is a simple way to setup an iptables firewall configuration using 
						<a href="https://help.ubuntu.com/community/UFW">UFW</a>.<br>
						<br>
						First set the default configuration to <b>deny</b> everything:<br>
						<code>ufw default deny</code><br>
						<br>
						Now we allow only SSH and HTTP traffic through:<br>
						<code>ufw allow 22</code><br>
						<code>ufw allow 80</code><br>
						<br>
						Enable logging:<br>
						<code>ufw logging on</code><br>
						<br>
						Turn it on:<br>
						<code>ufw enable</code><br>
						<br>
						Test it and view rules:<br>
						<code>ufw status</code><br>
						<br>
						<img class="listImage" src="img/firewall-enabled.png" alt="Firewall enabled"><br>
						<br>
						Now the firewall is enabled and logging. There are potentially other advanced configuration options you could use to harden 
						up the firewall and server more. You will need to do some more of your own research for that. The current configuration will 
						allow any IP to connect on those ports. If the IP address of you and your chat partner can change (ie dynamically assigned 
						from your ISP) then this is fine.<br>
						<br>
						If both chat partners have static IP addresses you could restrict access to only those IPs through the 
						firewall. If both chat partners are in the same country you could only allow IPs from that country to connect. If both chat 
						partners are outside the US and in different countries you could potentially 
						<a href="http://www.ipaddresslocation.org/ip_ranges/get_ranges.php">firewall off</a> the entire US from connecting to your 
						server. That would help mitigate the NSA and their <a href="https://en.wikipedia.org/wiki/Tailored_Access_Operations">Tailored Access Operations</a> 
						team from finding your server easily.<br>
						<br>
						Other options include changing the default SSH port to a random one. While not increasing the security it will cut down  
						the number of entries in the log file from basic attackers scanning for servers with the default SSH ports open. If you get log 
						attempts after changing the port then it would more likely indicate a targeted attack.
					</p>
					
					
					<h2 id="ntp-setup">Network Time Protocol configuration</h2>
					<p>
						The server authentication protocol relies on both the client and server being time synchronised 
						relatively closely. Messages are sent with a UNIX timestamp and if they are received outside of 
						a one minute window then they are rejected by the server as an attacker could be delaying, 
						reordering or replaying messages.
					</p>
					<h3>Automatic install</h3>
					<p>
						First check which version of the NTP package can be installed using 
						<a href="https://en.wikipedia.org/wiki/Advanced_Packaging_Tool">APT</a>:<br>
						<code>apt-cache policy ntp</code><br>
						<br>
						If the version shown is <code>ntpd 4.2.8.p4</code> or later then you can simply install it using:<br>
						<code>apt-get install ntp</code><br>
						<br>
						If the version available from APT is <b>less</b> than 4.2.8.p4 e.g. 4.2.6.p5 then you will need 
						to manually install the latest version from the <a href="http://www.ntp.org">ntp.org</a> website 
						to <a href="https://askubuntu.com/questions/689565/how-to-update-ntpd-to-the-latest-version-to-patch-the-latest-vulnerability">mitigate a new attack</a> 
						which could allow an attacker to arbitrarily set your server time and therefore block the 
						clients from connecting.
					</p>
					<h3>Manual install</h3>
					<p>
						The manual install procedure is as follows:<br>
						<code>cd ~<br>
						wget http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ntp-4.2.8p4.tar.gz<br>
						md5sum ntp-4.2.8p4.tar.gz<br>
						sha384sum ntp-4.2.8p4.tar.gz</code><br>
						<br>
						Check that the results match the hashes below or your might have a bad file:<br>
						MD5: <code>6af96862b09324a8ef965ca76b759c8b</code><br>
						SHA2-384: <code>c09e36a467b764aabb143668137cb752a42af0e4e2162131f82b234686dfcc7892ab821295ea8e596248cbf1c50e4479</code><br>
						<br>
						If the hashes match, extract the files and install:<br>
						<code>tar xvfz ntp-4.2.8p4.tar.gz<br>
						cd ntp-4.2.8p4/<br>
						./configure<br>
						make<br>
						make install</code>
					</p>
					<h3>Post installation</h3>
					<p>
						After installation, to get the server time in sync, run the following commands:<br>
						<code>
							service ntp stop<br>
							ntpd -gq<br>
							service ntp start
						</code><br>
						<br>
						The <code>-gq</code> parameter tells the ntp daemon to correct the time regardless of the 
						offset (g) and exit immediately (q). After this run the command:<br>
						<code>date</code><br>
						<br>
						Check that this time is within a few seconds of the time on your PC's clock. Your PC may need 
						to be synchronized to an NTP server as well but usually this is done automatically.
					</p>
					<h3>Keeping the clock synced</h3>
					<p>
						It is important to keep the time regularly synced to an NTP server or it will eventually drift out of sync by several 
						seconds or minutes. First create a simple time sync script:<br>
						<code>
							cd ~<br>
							nano timesync.sh<br>
						</code><br>
						<br>
						Paste the following text into the text file using Nano:<br>
						<code>
							#!/bin/sh<br>
							service ntp stop<br>
							ntpd -gq<br>
							service ntp start<br>
						</code><br>
						<br>
						Save and exit the file (Ctrl + X then Y then Enter). Now make the script executable with:<br>
						<code>chmod +x timesync.sh</code><br>
						<br>
						Edit the crontab to schedule the script to run:<br>
						<code>crontab -e</code><br>
						<br>
						Note: It may ask you to choose the editor, for this you should choose Nano.	Paste the following at the end of 
						the text file:<br>
						<code>
							00 3,15 * * * /root/timesync.sh<br>
							@reboot /root/timesync.sh<br>
						</code><br>
						<br>
						Save and exit the file (Ctrl + X then Y then Enter). Now the script will sync the server's clock to an NTP server 
						at 3am and 3pm every day and whenever the server boots up.
					</p>
										
					<h2 id="test-server-code">Test the server code</h2>
					<p>
						Now we can test the connection to the server. The client program will do that automatically for you. If 
						you still have the Export dialog open from earlier you can enter your server IP address and the matching 
						server key from the config file then click <b>Test server connection</b>. If you closed the page from earlier, 
						there is also a <b>Test server connection</b> button on the main menu.<br>
						<br>
						If it is still not working, you can try setting the <code>testResponseHeaders</code> key to <code>true</code> 
						in the <code>$applicationConfig</code> array of the <code>/var/www/html/config/config.php</code> file. This 
						enables a more specific error message to be sent back with the HTTP/1.1 404 error response code. 
						The Web Developer console in Firefox can view the error message sent back. This is found under  
						Tools -> Web Developer -> Web Console or simply Ctrl + Shift + K to open it. Once installed, simply 
						press F12 and it will open. Then retry the connection and view the error. That will give you a clue about 
						what needs to be fixed:<br>
						<br>
						<img class="listImage" src="img/test-connection-browser-console.png" alt="Web console"><br>
						<br>
						If you notice some sort of database error it probably means your database password (in the <code>config.php</code> 
						file) is incorrect. Either that or other database connection details may be incorrect. Basic shared hosting 
						users (non VPS) might also need to edit the UNIX socket and port numbers in the <b>config.php</b> file 
						with settings provided by the hosting provider.<br>
						<br>
						If the error is something about the timestamp being incorrect, perhaps your PC and the server are not 
						synchronized to an NTP server. Try updating both then try again. Do not connect to NTP servers run by 
						the NIST.<br>
						<br>
						If the MAC is incorrect then you likely don't have the same key on the server as the client.<br>
						<br>						
						Remember to set the <code>testResponseHeaders</code> key to <code>false</code> once you have resolved the 
						issue, otherwise this leaves clues for an attacker.
					</p>
					
					
					<h2 id="summary">Summary</h2>
					<p>
						To sum up we configured Linux, Apache, PHP, MySQL and the server side of Jericho Comms. We setup a separate 
						secure browser profile, then we configured a firewall to protect the server.<br>
						<br>
						If Firefox portable was used to setup a secure browser profile, you can copy that installation directory to a removable storage 
						device (e.g. USB drive) and give that to the other chat partner. That saves them time in setting up the browser and loading the 
						certificate. Usually one person (probably the person following this guide) may be more technically minded than the other person so 
						it's important to make the process as easy as possible for the other person.<br>
						<br>
						This covers the basics of configuring a secure web server. There are probably many other things that can be done to lock it 
						down even further. For example, <a href="https://www.digitalocean.com/community/articles/how-to-set-up-ssh-keys--2">using SSH keys</a> 
						for logging into the server with SSH. You should do your own research in this area. At the end of the day the server basically 
						functions as <a href="http://en.wikipedia.org/wiki/Dead_drop">dead-drop</a> for the encrypted communications. Nothing actually 
						sensitive is stored on it, only encrypted messages. These are secured by a one-time pad and can't be decrypted without the 
						correct key.<br>
						<br>
						However you do not really want to advertise the server's existence. You only want yourself and your chat partner to know about it. 
						If the NSA find out about it and their <a href="https://en.wikipedia.org/wiki/Tailored_Access_Operations">TAO</a> team decide to 
						target you, there won't be much you can do to stop them. They have teams of hackers working on 
						<a href="http://en.wikipedia.org/wiki/Zero-day_attack">zero-day</a> exploits for most software and firewalls. If they want in, 
						they will probably find a way. If you find they are targeting your server it is best to try initiating the auto nuke to clear 
						any remaining server messages, abandon the server and then create a new one somewhere else.<br>
						<br>
						You can continue with the <a href="installation-client.html">client installation guide</a> now.
					</p>					
				</div>
				<div class="clear"></div>
			</div>
		</div>
		
		<div class="footer">
			<ul class="links">
				<li>
					<a href="index.html">Home</a>
				</li>
				<li>-</li>
				<li>
					<a href="information.html">Technical design</a>
				</li>
				<li>-</li>
				<li>
					<a href="download.html">Download</a>
				</li>
				<li>-</li>
				<li>
					<a href="https://github.com/joshua-m-david/jerichoencryption">Source code</a>
				</li>				
				<li>-</li>
				<li>
					<a href="installation.html">How to install</a>
				</li>
				<li>-</li>
				<li>
					<a href="usage.html">How to use</a>
				</li>
				<li>-</li>
				<li>
					<a href="faq.html">FAQ</a>
				</li>
			</ul>
			<div class="donate">
				Want to support the project?<br>
				Bitcoin: <code>16h8K8sXCobL5u7wKRPG95F8XAc735P8TM</code><br>
				Litecoin: <code>Ld2X3Uyknq87GktF38q2ZQopyevRwC4hji</code>
			</div>
			<div class="copyright">
				Copyright &copy; 2013 - 2017 Joshua M. David
			</div>
		</div>
	</body>
</html>
